"use strict";(self["webpackChunkchat_quasar"]=self["webpackChunkchat_quasar"]||[]).push([[738],{3015:(e,t,l)=>{l.r(t),l.d(t,{default:()=>P});var a=l(3673);const s={id:"container-yacht-game"},o={class:"height-full full-width row items-center justify-center"},c={class:"col-4 full-height"};function i(e,t,l,i,r,n){const d=(0,a.up)("Yacht",!0),u=(0,a.up)("RoomVue");return(0,a.wg)(),(0,a.iD)("div",s,[(0,a._)("div",o,[(0,a.Wm)(d,{class:"col"}),(0,a._)("div",c,[(0,a.Wm)(u)])])])}var r=l(1959),n=l(2323);const d={class:"column"},u={class:"text-center q-mt-sm q-gutter-x-lg"},h={class:"fs-125 text-weight-bold text-vertical-bottom"};function f(e,t,l,s,o,c){const i=(0,a.up)("YachtDice"),r=(0,a.up)("q-card-section"),f=(0,a.up)("q-card"),m=(0,a.up)("q-btn");return(0,a.wg)(),(0,a.iD)("div",d,[(0,a.Wm)(f,{bordered:""},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{class:"flex items-center justify-between q-gutter-x-xl"},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.iD)(a.HY,null,(0,a.Ko)(["first","second","third","fourth","fifth"],((t,l)=>(0,a.Wm)(i,{key:`roll-dice-${l}`,diceValue:e.dice[t].value,fixed:e.dice[t].fixed,roll:e.dice[t].roll,onClick:l=>e.fixedDice(e.dice[t])},null,8,["diceValue","fixed","roll","onClick"]))),64))])),_:1})])),_:1}),(0,a._)("div",u,[(0,a.Wm)(m,{label:"게임 시작",color:"primary",onClick:t[0]||(t[0]=t=>e.startGame()),disable:e.gameState},null,8,["disable"]),(0,a.Wm)(m,{label:"굴리기",color:"primary",onClick:t[1]||(t[1]=t=>e.rollDice()),disable:3===e.times||!e.gameState},null,8,["disable"]),(0,a._)("span",h,(0,n.zw)(e.times)+" / 3 ",1)])])}const m=(0,a.aZ)({props:{diceValue:{type:Number,validator:e=>e>=1&&e<=6,required:!0}},setup(e){const t=Array.from({length:e.diceValue},((e,t)=>t+1)).map((e=>(0,a.h)("div",{class:"dice-face__dot round-radius"})));return()=>(0,a.h)("div",{class:`dice-face dice-face__${e.diceValue}`},t)}}),p=(0,a.aZ)({props:{diceValue:{type:Number,validator:e=>e>=1&&e<=6,required:!0},roll:{type:Boolean},fixed:{type:Boolean}},setup(e){return()=>(0,a.h)("div",{class:`dice dice__show-${e.diceValue} ${e.roll?"roll-dice":""} ${e.fixed?"dice__fixed":""}`},[(0,a.h)(m,{diceValue:1}),(0,a.h)(m,{diceValue:2}),(0,a.h)(m,{diceValue:3}),(0,a.h)(m,{diceValue:4}),(0,a.h)(m,{diceValue:5}),(0,a.h)(m,{diceValue:6})])}});var v=l(1795),b=l(52),w=l.n(b),g=l(6114),y=function(e,t,l,a){function s(e){return e instanceof l?e:new l((function(t){t(e)}))}return new(l||(l=Promise))((function(l,o){function c(e){try{r(a.next(e))}catch(t){o(t)}}function i(e){try{r(a["throw"](e))}catch(t){o(t)}}function r(e){e.done?l(e.value):s(e.value).then(c,i)}r((a=a.apply(e,t||[])).next())}))};const x=(0,a.aZ)({components:{YachtDice:p},data(){return{dice:{first:{value:1,fixed:!1,roll:!1},second:{value:1,fixed:!1,roll:!1},third:{value:1,fixed:!1,roll:!1},fourth:{value:1,fixed:!1,roll:!1},fifth:{value:1,fixed:!1,roll:!1}},times:0}},computed:{gameState:function(){return this.$store.getters["StompModule/isYachtStarted"]}},created(){if(!g.Wb){const e=setInterval((()=>{this.$store.getters["StompModule/getConnectStatus"]&&(clearInterval(e),this.$store.dispatch("StompModule/SubscribeYachtList"),this.gameState)}),1e3)}},methods:{rollDice(){return y(this,void 0,void 0,(function*(){this.$data.times+=1,this.rollDiceEach(this.$data.dice.first),this.rollDiceEach(this.$data.dice.second),this.rollDiceEach(this.$data.dice.third),this.rollDiceEach(this.$data.dice.fourth),this.rollDiceEach(this.$data.dice.fifth),yield(0,v.Z)(1),this.$emit("update:diceValue",{first:this.$data.dice.first.value,second:this.$data.dice.second.value,third:this.$data.dice.third.value,fourth:this.$data.dice.fourth.value,fifth:this.$data.dice.fifth.value})}))},rollDiceEach(e){return y(this,void 0,void 0,(function*(){e.fixed||(e.roll=!0,yield(0,v.Z)(1),e.value=this.getRandomFace(),e.roll=!1)}))},fixedDice(e){e.fixed=!e.fixed},getRandomFace(){var e;const t=(null===(e=window.crypto)||void 0===e?void 0:e.getRandomValues(new Uint32Array(1))[0])/4294967296;return Math.floor(6*t+1)},startGame(){w().put(`/room/${this.$route.params.roomId}/start`).then((({data:e,status:t})=>{200===t&&this.$store.dispatch("StompModule/setterYachtState",!0)}))}}});var S=l(4260),_=l(151),q=l(5589),$=l(8240),D=l(7518),k=l.n(D);const W=(0,S.Z)(x,[["render",f]]),Y=W;k()(x,"components",{QCard:_.Z,QCardSection:q.Z,QBtn:$.Z});const Z=e=>((0,a.dD)("data-v-0abb116c"),e=e(),(0,a.Cn)(),e),V=(0,a.Uk)("점수판"),C=Z((()=>(0,a._)("div",{class:"full-height full-width flex items-center justify-center"}," 대기중 ",-1))),I=Z((()=>(0,a._)("div",{class:"col flex items-center justify-center"}," 게임이 시작되지 않았습니다. ",-1)));function H(e,t,l,s,o,c){const i=(0,a.up)("q-card-section"),r=(0,a.up)("q-separator"),d=(0,a.up)("q-tooltip"),u=(0,a.up)("q-icon"),h=(0,a.up)("q-card");return(0,a.wg)(),(0,a.j4)(h,{class:"width-inherit q-mb-sm text-center",flat:"",square:""},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{horizontal:"",class:"q-pa-none row full-height width-inherit"},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{class:"col-2 sticky left-0px q-pa-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{flat:"",bordered:"",class:"bg-blue-2 full-height text-weight-bold column",square:""},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{class:"q-pa-none q-py-sm col"},{default:(0,a.w5)((()=>[V])),_:1}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.rules,((e,t)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:`rule-${t}`},[(0,a.Wm)(r),(0,a.Wm)(i,{class:"q-pa-none q-py-sm col"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.label)+" ",1),e.desc?((0,a.wg)(),(0,a.j4)(u,{key:0,name:"info",class:"cursor-pointer info"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.desc),1)])),_:2},1024)])),_:2},1024)):(0,a.kq)("",!0)])),_:2},1024)],64)))),128))])),_:1})])),_:1}),e.users.length?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:0},(0,a.Ko)(e.users,((t,l)=>((0,a.wg)(),(0,a.j4)(i,{key:`user-${t.userName}-${l}`,class:"col q-pa-none scroll-x row no-wrap"},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{flat:"",bordered:"",class:"full-height col min-width-200px",square:""},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{class:"q-pa-none q-py-sm q-py-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(t.userName),1)])),_:2},1024),t.scoreBoard.length?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:0},(0,a.Ko)(t.scoreBoard,((l,s)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:`user-${l.id}-${s}`},[(0,a.Wm)(r),(0,a.Wm)(i,{class:(0,n.C_)(["q-pa-none q-py-sm col min-height-37px",`${l.score?"bg-green-5":""} ${!["합계","보너스"].includes(l.label)&&e.currentDice&&t.myTurn?"cursor-pointer":""}`]),onClick:()=>!["합계","보너스"].includes(l.label)&&e.currentDice&&t.myTurn?e.getScore(t,l.label):{}},{default:(0,a.w5)((()=>[e.decodeToken().id===t.id?((0,a.wg)(),(0,a.iD)("span",{key:0,class:(0,n.C_)([!l.score&&e.hint[l.label]?"text-grey-5":"","text-weight-bold"])},(0,n.zw)(l.score||e.hint[l.label]||""),3)):((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Uk)((0,n.zw)(l.score||""),1)],64))])),_:2},1032,["class","onClick"])],64)))),128)):((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Wm)(r),C],64))])),_:2},1024)])),_:2},1024)))),128)):((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Wm)(i,{class:"col q-pa-none column"},{default:(0,a.w5)((()=>[(0,a.Wm)(r),I,(0,a.Wm)(r)])),_:1}),(0,a.Wm)(r,{vertical:""})],64))])),_:1})])),_:1})}const M=[{label:"Ones",desc:"1 눈금의 합계"},{label:"Twos",desc:"2 눈금의 합계"},{label:"Threes",desc:"3 눈금의 합계"},{label:"Fours",desc:"4 눈금의 합계"},{label:"Fives",desc:"5 눈금의 합계"},{label:"Sixes",desc:"6 눈금의 합계"},{label:"보너스",desc:"위 합계들의 합이 63을 넘으면 보너스 35점"},{label:"초이스",desc:"모든 눈금의 합"},{label:"풀하우스",desc:"같은 눈금의 주사위 3개와 나머지 같은 눈금의 주사위 2개의 모든 눈금의 합"},{label:"Four of a kind",desc:"같은 숫자가 4개일때 모든 눈금의 합"},{label:"라지 스트레이트",desc:"주사위의 눈금이 5개가 연결될때 40점"},{label:"스몰 스트레이트",desc:"주사위의 눈금이 4개가 연결될때 30점"},{label:"Yacht",desc:"모두 같은 눈금일때 50점"},{label:"합계"}],T=[{label:"ones",value:"ones",score:0},{label:"twos",value:"twos",score:0},{label:"threes",value:"threes",score:0},{label:"fours",value:"fours",score:0},{label:"fives",value:"fives",score:0},{label:"sixes",value:"sixes",score:0},{label:"bonus",value:"bonus",score:0},{label:"choice",value:"chance",score:0},{label:"fullHouse",value:"fullHouse",score:0},{label:"fourOf",value:"fourOfKind",score:0},{label:"lgSt",value:"largeStraight",score:0},{label:"smSt",value:"smallStraight",score:0},{label:"yacht",value:"yahtzee",score:0},{label:"합계",value:"totalScore",score:0}],j=(0,a.aZ)({props:["currentDice"],data(){return{rules:M,hint:{ones:0,twos:0,threes:0,fours:0,fives:0,sixes:0,chance:0,fullHouse:0,fourOf:0,lgSt:0,smSt:0,yahtzee:0}}},computed:{users:function(){var e;return((null===(e=this.$store.getters["StompModule/getYachtScoreBoard"])||void 0===e?void 0:e.userInfos)||[]).map((e=>({id:e.userId,userName:e.userName,simpSessionId:e.simpSessionId,myTurn:e.TurnUserId===this.decodeToken().id,scoreBoard:T.map((t=>(t.score=e[t.value]||0,t)))})))}},methods:{getScore(e,t){console.log(e,t),this.$store.dispatch("StompModule/sendYachtGetScore",{roomId:this.$route.params.roomId,simpSessionId:e.simpSessionId,scoreType:t,score:this.hint[t]||0})},sendDice(e){w().post("/expected/score",{dices:Object.values(e)}).then((({data:e})=>{this.hint=e}))}},watch:{currentDice:{deep:!0,handler(e,t){this.sendDice(e)}}}});var z=l(5869),Q=l(4554),U=l(8870);const B=(0,S.Z)(j,[["render",H],["__scopeId","data-v-0abb116c"]]),E=B;k()(j,"components",{QCard:_.Z,QCardSection:q.Z,QSeparator:z.Z,QIcon:Q.Z,QTooltip:U.Z});const N=(0,a.aZ)({setup(){const e=(0,r.iH)(null);return()=>(0,a.h)("div",{class:"full-height q-mb-md full-width"},[(0,a.h)(E,{currentDice:e.value}),(0,a.h)(Y,{"onUpdate:diceValue":t=>e.value=t})])}});var F=l(637),K=l(9582),O=l(3091),R=function(e,t,l,a){function s(e){return e instanceof l?e:new l((function(t){t(e)}))}return new(l||(l=Promise))((function(l,o){function c(e){try{r(a.next(e))}catch(t){o(t)}}function i(e){try{r(a["throw"](e))}catch(t){o(t)}}function r(e){e.done?l(e.value):s(e.value).then(c,i)}r((a=a.apply(e,t||[])).next())}))};const G=(0,a.aZ)({components:{Yacht:N,RoomVue:F["default"]},setup(){const e=(0,O.useStore)(),t=(0,K.yj)(),l=()=>R(this,void 0,void 0,(function*(){yield e.dispatch("StompModule/connect").then((()=>{e.dispatch("StompModule/SubscribeYacht",t.params.roomId)})).catch((()=>{l()}))}));return(()=>{e.getters["StompModule/getConnectStatus"]?e.dispatch("StompModule/SubscribeYacht",t.params.roomId):l()})(),{}}}),A=(0,S.Z)(G,[["render",i]]),P=A}}]);