"use strict";(self["webpackChunkchat_quasar"]=self["webpackChunkchat_quasar"]||[]).push([[100],{7100:(e,l,t)=>{t.r(l),t.d(l,{default:()=>ee});var a=t(3673);const s={id:"container-yacht-game"},o={class:"height-full full-width row items-center justify-center"},r={class:"col-4 full-height"};function i(e,l,t,i,n,c){const u=(0,a.up)("Yacht",!0),d=(0,a.up)("RoomVue");return(0,a.wg)(),(0,a.iD)("div",s,[(0,a._)("div",o,[(0,a.Wm)(u,{class:"col"}),(0,a._)("div",r,[(0,a.Wm)(d)])])])}var n=t(1959),c=t(2323);const u={class:"column"},d={class:"text-center q-mt-sm q-gutter-x-lg"},h={class:"fs-125 text-weight-bold text-vertical-bottom"};function f(e,l,t,s,o,r){const i=(0,a.up)("YachtDice"),n=(0,a.up)("q-card-section"),f=(0,a.up)("q-card"),m=(0,a.up)("q-btn");return(0,a.wg)(),(0,a.iD)("div",u,[(0,a.Wm)(f,{bordered:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{class:"flex items-center justify-between q-gutter-x-xl"},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.iD)(a.HY,null,(0,a.Ko)(["first","second","third","fourth","fifth"],((l,t)=>(0,a.Wm)(i,{key:`roll-dice-${t}-${e.currentTime}`,diceValue:e.dice[l].value,fixed:e.dice[l].fixed,roll:e.dice[l].roll,onClick:t=>e.myTurn?e.fixedDice(e.dice[l]):()=>{},class:(0,c.C_)(e.myTurn?"cursor-pointer":"cursor-not-allowed")},null,8,["diceValue","fixed","roll","onClick","class"]))),64))])),_:1})])),_:1}),(0,a._)("div",d,[(0,a.Wm)(m,{label:"게임 시작",color:"primary",onClick:l[0]||(l[0]=l=>e.startGame()),disable:e.gameState},null,8,["disable"]),(0,a.Wm)(m,{label:"굴리기",color:"primary",onClick:l[1]||(l[1]=l=>e.rollDice()),disable:!e.gameState||3===e.times||!e.myTurn},null,8,["disable"]),(0,a._)("span",h,(0,c.zw)(e.times)+" / 3 ",1)])])}const m=(0,a.aZ)({props:{diceValue:{type:Number,validator:e=>e>=1&&e<=6,required:!0}},setup(e){const l=Array.from({length:e.diceValue},((e,l)=>l+1)).map((e=>(0,a.h)("div",{class:"dice-face__dot round-radius"})));return()=>(0,a.h)("div",{class:`dice-face dice-face__${e.diceValue}`},l)}}),p=(0,a.aZ)({props:{diceValue:{type:Number,validator:e=>e>=1&&e<=6,required:!0},roll:{type:Boolean},fixed:{type:Boolean}},setup(e){return()=>(0,a.h)("div",{class:`dice dice__show-${e.diceValue} ${e.roll?"roll-dice":""} ${e.fixed?"dice__fixed":""}`},[(0,a.h)(m,{diceValue:1}),(0,a.h)(m,{diceValue:2}),(0,a.h)(m,{diceValue:3}),(0,a.h)(m,{diceValue:4}),(0,a.h)(m,{diceValue:5}),(0,a.h)(m,{diceValue:6})])}});var v=t(1795),g=t(52),w=t.n(g),b=t(6114),S=t(1488),x=t.n(S),y=function(e,l,t,a){function s(e){return e instanceof t?e:new t((function(l){l(e)}))}return new(t||(t=Promise))((function(t,o){function r(e){try{n(a.next(e))}catch(l){o(l)}}function i(e){try{n(a["throw"](e))}catch(l){o(l)}}function n(e){e.done?t(e.value):s(e.value).then(r,i)}n((a=a.apply(e,l||[])).next())}))};const $=(0,a.aZ)({components:{YachtDice:p},data(){return{dice:{first:{value:1,fixed:!1,roll:!1},second:{value:1,fixed:!1,roll:!1},third:{value:1,fixed:!1,roll:!1},fourth:{value:1,fixed:!1,roll:!1},fifth:{value:1,fixed:!1,roll:!1}},times:0}},computed:{gameState:function(){return this.$store.getters["StompModule/isYachtStarted"]},myTurn:function(){var e;const l=(null===(e=this.$store.getters["StompModule/getYachtScoreBoard"])||void 0===e?void 0:e.turnUserId)===this.decodeToken().id;return l},currentTime:function(){return x()(new Date).format("YYYYMMDDHHmmss")}},created(){if(!b.Wb){const e=setInterval((()=>{this.$store.getters["StompModule/getConnectStatus"]&&(clearInterval(e),this.$store.dispatch("StompModule/SubscribeYachtList"),this.gameState)}),1e3)}},methods:{rollDice(){return y(this,void 0,void 0,(function*(){this.$data.times+=1,this.rollDiceEach(this.$data.dice.first),this.rollDiceEach(this.$data.dice.second),this.rollDiceEach(this.$data.dice.third),this.rollDiceEach(this.$data.dice.fourth),this.rollDiceEach(this.$data.dice.fifth),yield(0,v.Z)(1),this.$emit("update:diceValue",{first:this.$data.dice.first.value,second:this.$data.dice.second.value,third:this.$data.dice.third.value,fourth:this.$data.dice.fourth.value,fifth:this.$data.dice.fifth.value})}))},rollDiceEach(e){return y(this,void 0,void 0,(function*(){e.fixed||(e.roll=!0,yield(0,v.Z)(1),e.value=this.getRandomFace(),e.roll=!1)}))},fixedDice(e){e.fixed=!e.fixed},getRandomFace(){var e;const l=(null===(e=window.crypto)||void 0===e?void 0:e.getRandomValues(new Uint32Array(1))[0])/4294967296;return Math.floor(6*l+1)},startGame(){w().put(`/room/${this.$route.params.roomId}/start`).then((({data:e,status:l})=>{200===l&&this.$store.dispatch("StompModule/setterYachtState",!0)}))}},watch:{myTurn:{handler:function(e,l){e!==l&&(this.times=0,this.dice={first:{value:1,fixed:!1,roll:!1},second:{value:1,fixed:!1,roll:!1},third:{value:1,fixed:!1,roll:!1},fourth:{value:1,fixed:!1,roll:!1},fifth:{value:1,fixed:!1,roll:!1}})},deep:!0}}});var _=t(4260),q=t(151),D=t(5589),k=t(8240),Y=t(7518),T=t.n(Y);const W=(0,_.Z)($,[["render",f]]),Z=W;T()($,"components",{QCard:q.Z,QCardSection:D.Z,QBtn:k.Z});const C=e=>((0,a.dD)("data-v-52dac966"),e=e(),(0,a.Cn)(),e),I=(0,a.Uk)("점수판"),V={key:2,class:"absolute-full flex flex-center"},M=C((()=>(0,a._)("div",{class:"full-height full-width flex items-center justify-center"}," 대기중 ",-1))),H=C((()=>(0,a._)("div",{class:"col flex items-center justify-center"}," 게임이 시작되지 않았습니다. ",-1)));function z(e,l,t,s,o,r){const i=(0,a.up)("q-card-section"),n=(0,a.up)("q-separator"),u=(0,a.up)("q-tooltip"),d=(0,a.up)("q-icon"),h=(0,a.up)("q-card"),f=(0,a.up)("q-linear-progress");return(0,a.wg)(),(0,a.j4)(h,{class:"width-inherit q-mb-sm text-center",flat:"",square:""},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{horizontal:"",class:"q-pa-none row full-height width-inherit"},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{class:"col-2 sticky left-0px q-pa-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{flat:"",bordered:"",class:"bg-blue-2 full-height text-weight-bold column",square:""},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{class:"q-pa-none q-py-sm col"},{default:(0,a.w5)((()=>[I])),_:1}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.rules,((e,l)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:`rule-${l}`},[(0,a.Wm)(n),(0,a.Wm)(i,{class:"q-pa-none q-py-sm col"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,c.zw)(e.label)+" ",1),e.desc?((0,a.wg)(),(0,a.j4)(d,{key:0,name:"info",class:"cursor-pointer info"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,c.zw)(e.desc),1)])),_:2},1024)])),_:2},1024)):(0,a.kq)("",!0)])),_:2},1024)],64)))),128))])),_:1})])),_:1}),e.users.length?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:0},(0,a.Ko)(e.users,((l,t)=>((0,a.wg)(),(0,a.j4)(i,{key:`user-${l.userName}-${t}`,class:"col q-pa-none scroll-x row no-wrap"},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{flat:"",bordered:"",class:"full-height col min-width-200px",square:""},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{class:"q-pa-none q-py-sm q-py-sm"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,c.zw)(l.userName),1)])),_:2},1024),l.scoreBoard.length?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:0},(0,a.Ko)(l.scoreBoard,((t,s)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:`user-${t.id}-${s}`},[(0,a.Wm)(n),(0,a.Wm)(i,{class:(0,c.C_)(["q-pa-none col min-height-37px",`\n                      ${null!==t.score&&"bonus"!==t.value?"bg-green-5":""} ${null===t.score&&"bonus"!==t.value&&!["합계","보너스"].includes(t.label)&&e.currentDice&&l.id===this.decodeToken().id?"cursor-pointer":""}`]),onClick:()=>null===t.score&&"bonus"!==t.value&&!["합계","보너스"].includes(t.label)&&e.currentDice&&l.id===this.decodeToken().id?e.getScore(l,t.value):{}},{default:(0,a.w5)((()=>["bonus"===t.value?((0,a.wg)(),(0,a.j4)(f,{key:0,size:"37px",value:(t.generalScoreTotal||0)/63,color:"green-5",class:"q-pa-none"},{default:(0,a.w5)((()=>[(0,a._)("span",{class:(0,c.C_)(["absolute-full flex flex-center",(t.generalScoreTotal||0)/63<.5?"text-dark":"text-white"]),style:{"font-size":"14px"}},(0,c.zw)(t.score||0)+" "+(0,c.zw)(`(${t.generalScoreTotal} / 63)`),3)])),_:2},1032,["value"])):e.decodeToken().id===l.id?((0,a.wg)(),(0,a.iD)("span",{key:1,class:(0,c.C_)([null===t.score&&null!==e.hint[t.value]?"text-grey-5 text-weight-bold":"","absolute-full flex flex-center"])},(0,c.zw)(null!==t.score?t.score:!["합계","보너스"].includes(t.label)&&e.currentDice&&l.myTurn&&null!==e.hint[t.value]?e.hint[t.value]:""),3)):((0,a.wg)(),(0,a.iD)("span",V,(0,c.zw)(null!==t.score?t.score:""),1))])),_:2},1032,["class","onClick"])],64)))),128)):((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Wm)(n),M],64))])),_:2},1024)])),_:2},1024)))),128)):((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Wm)(i,{class:"col q-pa-none column"},{default:(0,a.w5)((()=>[(0,a.Wm)(n),H,(0,a.Wm)(n)])),_:1}),(0,a.Wm)(n,{vertical:""})],64))])),_:1})])),_:1})}const B=[{label:"Ones",desc:"1 눈금의 합계"},{label:"Twos",desc:"2 눈금의 합계"},{label:"Threes",desc:"3 눈금의 합계"},{label:"Fours",desc:"4 눈금의 합계"},{label:"Fives",desc:"5 눈금의 합계"},{label:"Sixes",desc:"6 눈금의 합계"},{label:"보너스",desc:"위 합계들의 합이 63을 넘으면 보너스 35점"},{label:"초이스",desc:"모든 눈금의 합"},{label:"풀하우스",desc:"같은 눈금의 주사위 3개와 나머지 같은 눈금의 주사위 2개의 모든 눈금의 합"},{label:"Four of a kind",desc:"같은 숫자가 4개일때 모든 눈금의 합"},{label:"라지 스트레이트",desc:"주사위의 눈금이 5개가 연결될때 40점"},{label:"스몰 스트레이트",desc:"주사위의 눈금이 4개가 연결될때 30점"},{label:"Yacht",desc:"모두 같은 눈금일때 50점"},{label:"합계"}],j=[{label:"ones",value:"ones",score:null},{label:"twos",value:"twos",score:null},{label:"threes",value:"threes",score:null},{label:"fours",value:"fours",score:null},{label:"fives",value:"fives",score:null},{label:"sixes",value:"sixes",score:null},{label:"bonus",value:"bonus",score:0,generalScoreTotal:0},{label:"choice",value:"chance",score:null},{label:"fullHouse",value:"fullHouse",score:null},{label:"fourOf",value:"fourOfKind",score:null},{label:"lgSt",value:"largeStraight",score:null},{label:"smSt",value:"smallStraight",score:null},{label:"yacht",value:"yahtzee",score:null},{label:"합계",value:"totalScore",score:0}],N=(0,a.aZ)({props:["currentDice"],data(){return{rules:B,hint:{ones:null,twos:null,threes:null,fours:null,fives:null,sixes:null,chance:null,fullHouse:null,fourOfKind:null,largeStraight:null,smallStraight:null,yahtzee:null}}},computed:{users:function(){var e;return 0===this.$store.getters["StompModule/getYachtScoreBoard"].remainingTurns?(this.$q.dialog({title:"승자!!",message:this.$store.getters["StompModule/getYachtScoreBoard"].userInfos.sort(((e,l)=>l.totalScore-e.totalScore))[0].userName}),[]):((null===(e=this.$store.getters["StompModule/getYachtScoreBoard"])||void 0===e?void 0:e.userInfos)||[]).map((e=>{const l={id:e.userId,userName:e.userName,simpSessionId:e.simpSessionId,myTurn:this.$store.getters["StompModule/getYachtScoreBoard"].turnUserId===this.decodeToken().id,scoreBoard:j.map((l=>{const t=JSON.parse(JSON.stringify(l));return t.score=null===e[t.value]?null:0===e[t.value]?0:e[t.value]||"","bonus"===t.value&&(t.generalScoreTotal=e.generalScoreTotal),t}))};return l}))}},methods:{getScore(e,l){console.log(e,l),this.$store.dispatch("StompModule/sendYachtGetScore",{roomId:this.$route.params.roomId,simpSessionId:e.simpSessionId,scoreType:l,score:this.hint[l]||0}).then((()=>{this.hint={ones:null,twos:null,threes:null,fours:null,fives:null,sixes:null,chance:null,fullHouse:null,fourOfKind:null,largeStraight:null,smallStraight:null,yahtzee:null}}))},sendDice(e){w().post("/expected/score",{dices:Object.values(e)}).then((({data:e})=>{this.hint=e}))}},watch:{currentDice:{deep:!0,handler(e,l){this.sendDice(e)}}}});var Q=t(5869),O=t(4554),U=t(8870),K=t(1598);const E=(0,_.Z)(N,[["render",z],["__scopeId","data-v-52dac966"]]),F=E;T()(N,"components",{QCard:q.Z,QCardSection:D.Z,QSeparator:Q.Z,QIcon:O.Z,QTooltip:U.Z,QLinearProgress:K.Z});const R=(0,a.aZ)({setup(){const e=(0,n.iH)(null);return()=>(0,a.h)("div",{class:"full-height q-mb-md full-width"},[(0,a.h)(F,{currentDice:e.value}),(0,a.h)(Z,{"onUpdate:diceValue":l=>e.value=l})])}});var G=t(29),P=t(9582),A=t(3091),J=function(e,l,t,a){function s(e){return e instanceof t?e:new t((function(l){l(e)}))}return new(t||(t=Promise))((function(t,o){function r(e){try{n(a.next(e))}catch(l){o(l)}}function i(e){try{n(a["throw"](e))}catch(l){o(l)}}function n(e){e.done?t(e.value):s(e.value).then(r,i)}n((a=a.apply(e,l||[])).next())}))};const L=(0,a.aZ)({components:{Yacht:R,RoomVue:G["default"]},setup(){const e=(0,A.useStore)(),l=(0,P.yj)(),t=()=>J(this,void 0,void 0,(function*(){yield e.dispatch("StompModule/connect").then((()=>{e.dispatch("StompModule/SubscribeYacht",l.params.roomId)})).catch((()=>{t()}))}));return(()=>{e.getters["StompModule/getConnectStatus"]?e.dispatch("StompModule/SubscribeYacht",l.params.roomId):t()})(),{}}}),X=(0,_.Z)(L,[["render",i]]),ee=X}}]);